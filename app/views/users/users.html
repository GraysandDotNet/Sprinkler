{% extends '../layouts/default.html' %}

{% block main %}
<h1>{{ title }}</h1>
{% endblock %}

{% block content %}

	<!-- preloadeing of userList via swig template substitution -->
			
	<!-- return a json object containing swig template data currentUser and users array -->
	<script>
		function swigTemplateData() 
		{
			return  {	currentUser: {{ currentUser | raw |json }}, 
						users: {{ users | raw | json }}
					};
		}
	</script>

	{% raw %}
	<!-- Angular -->
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	<!-- Angular controllers -->
	<script src="javascripts/userController.js"></script>

	<div ng-app="sprinklerApp">
		<div ng-controller="userCtrl">
			<div>
				<p>You have {{userList.length}} sprinkler user{{userList.length == 1 ? "" : "s"}}.</p>
			</div>

			<ul>
				<li ng-repeat="user in userList">
					<p>{{$index + 1}}. {{user.name}}</p>

					<button ng-click="startEdit($index)">Edit</button>
					<button ng-click="delete($index)">Delete</button>

					<div ng-show="userList[$index].vis">
						<form name="userEdit" ng-submit="endEdit(userEdit, $index)">
							<input required type="text" placeholder="{{userList[$index].name}}" ng-model="userNew.name" />

							<button type="submit" class="btn btn-default">Done</button>
						</form>
					</div>
				</li>
			</ul>

			<button ng-click="startAdd()">Add user</button>

			<div ng-show="userAddVis">
				<form name="userAdd" ng-submit="userCreate('userAdd')">
					<input required type="text" placeholder="User {{userList.length+1}}" ng-model="userNew.name" />

					<button type="submit">Done</button>
				</form>
			</div>

		</div>
	</div>
	{% endraw %}
{% endblock %}
